{
  "hash": "83b8857a40bf2ca568056867b23d1179",
  "result": {
    "markdown": "---\ntitle: \"time series intro\"\nauthor: 'jiyun Lim'\ndate: '03/01/2023'\ncategories: \n  - R\n  - TS\n  - ML\nformat:\n  html:\n    theme: default\n---\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n── Attaching packages ─────────────────────────────────────── tidyverse 1.3.2 ──\n✔ ggplot2 3.4.1     ✔ purrr   1.0.1\n✔ tibble  3.1.8     ✔ dplyr   1.1.0\n✔ tidyr   1.3.0     ✔ stringr 1.5.0\n✔ readr   2.1.4     ✔ forcats 1.0.0\n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\n```\n:::\n\n```{.r .cell-code}\nlibrary(forecast)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nRegistered S3 method overwritten by 'quantmod':\n  method            from\n  as.zoo.data.frame zoo \n```\n:::\n\n```{.r .cell-code}\nlibrary(recipes)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n\nAttaching package: 'recipes'\n\nThe following object is masked from 'package:stringr':\n\n    fixed\n\nThe following object is masked from 'package:stats':\n\n    step\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ntourist <- scan('./tourist.txt')\ntourist[10:13] <- NA\ntour <- scan('./tour.txt')\n\ntour <- c(tourist, tour)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ntour.ts <- ts(tour, start=1981, frequency=12)\n\ntour.ts %>% \n  autoplot()\n```\n\n::: {.cell-output-display}\n![](test-ts_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ntour.ts %>% \n  ggtsdisplay()\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: Removed 4 rows containing missing values (`geom_point()`).\n```\n:::\n\n::: {.cell-output-display}\n![](test-ts_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nggseasonplot(tour.ts)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: Removed 4 rows containing missing values (`geom_line()`).\n```\n:::\n\n::: {.cell-output-display}\n![](test-ts_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n- 결측치 존재\n- 추세존재\n- 계절성 존재\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntrain <- window(tour.ts, end = c(1991, 12), freq=12)\ntest <- window(tour.ts, start = c(1992, 1), freq=12)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(imputeTS)\nimputeTS::ggplot_na_distribution(train)\n```\n\n::: {.cell-output-display}\n![](test-ts_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n- 1981년 말부터 1982년 사이에 결측치가 존재함.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# 평균대치\nimp_na <- na_mean(train)\nimputeTS::ggplot_na_imputations(train, imp_na)\n```\n\n::: {.cell-output-display}\n![](test-ts_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n## exponential moving average\nimp_movmean <- na_ma(train, weighting='exponential', k=3)\nimputeTS::ggplot_na_imputations(train, imp_movmean)\n```\n\n::: {.cell-output-display}\n![](test-ts_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\n시계열 결측치 대치법에는 크게 평균대치와 exponential moving average 방법이 있다.\nexponential moving average방법은 결측치와 가까운 시점에 더 큰 가중치를 부여하므로, 시계열의 경향성을 반영할 수 있다.\n\n그림을 통해서도 알수있듯이, 평균대치법에 비해 exponential moving average를 이용한 방법이 시계열의 경향성을 반영하며, 적절하게 결측치를 대치해주는 것을 확인할 수 있다..\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nforecast::BoxCox.lambda(imp_movmean)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 0.1401004\n```\n:::\n:::\n\n\n- 로그변환 실시\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlntour <- log(imp_movmean)\nlntour %>% autoplot()\n```\n\n::: {.cell-output-display}\n![](test-ts_files/figure-html/unnamed-chunk-11-1.png){width=672}\n:::\n:::\n\n\n- 로그변환 결과, 시간에 따라 분산이 일정하게 안정화된 것을 볼 수 있음.\n\n\n`-` 추세와 계절성이 함께 존재하므로, 일반차분과 계절차분을 고려해볼 수 있을 것 같다.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntour_1 <- diff(lntour)\nggtsdisplay(tour_1, lag.max = 48)\n```\n\n::: {.cell-output-display}\n![](test-ts_files/figure-html/unnamed-chunk-12-1.png){width=672}\n:::\n:::\n\n\n- 계절차분을 고려해볼 수 있을 것 같다..\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntour_12 <- diff(lntour, lag=12)\nggtsdisplay(tour_12, lag.max=48)\n```\n\n::: {.cell-output-display}\n![](test-ts_files/figure-html/unnamed-chunk-13-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nndiffs(tour_12)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 1\n```\n:::\n:::\n\n- 계절차분 결과, 추세그래프와 acf plot을 확인해보면 추세가 존재하고, acf가 천천히 감소하는 것을 확인할 수 있다.\n\n- 추가적인 일반차분을 고려\n\n`-` d=1, D=1\n\n::: {.cell}\n\n```{.r .cell-code}\ntour_1_12 <- diff(tour_1, lag=12)\nggtsdisplay(tour_1_12, lag.max = 48)\n```\n\n::: {.cell-output-display}\n![](test-ts_files/figure-html/unnamed-chunk-15-1.png){width=672}\n:::\n:::\n\n\n\n- 추세가 사라졌으며, 계절성 또한 사라진 것 확인할 수 있다.\n- 따라서 계절차분과 일반차분 (d=1, D=1)을 동시에 고려.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nAcf(tour_1_12, lag.max = 48)\n```\n\n::: {.cell-output-display}\n![](test-ts_files/figure-html/unnamed-chunk-16-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nPacf(tour_1_12, lag.max=48)\n```\n\n::: {.cell-output-display}\n![](test-ts_files/figure-html/unnamed-chunk-17-1.png){width=672}\n:::\n:::\n\n\n**후보모형**\n- $ARIMA(0,1,1)(0,1,1)_{12}$\n- $ARIMA(0,1,1)(1,1,0)_{12}$\n- $ARIMA(2,1,0)(0,1,1)_{12}$\n- $ARIMA(2,1,0)(1,1,0)_{12}$\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfit1 <- Arima(lntour, order = c(0,1,1),\n              seasonal = list(order = c(0,1,1),period = 12))\n\nfit2 <- Arima(lntour, order = c(0,1,1),\n              seasonal = list(order = c(1,1,0), period = 12))\n\nfit3 <- Arima(lntour, order = c(2,1,0),\n              seasonal = list(order = c(0,1,1), period = 12))\n\nfit4 <- Arima(lntour, order = c(2,1,0),\n              seasonal = list(order = c(1,1,0), period = 12))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nAIC(fit1, fit2, fit3)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n     df       AIC\nfit1  3 -317.4803\nfit2  3 -316.1026\nfit3  4 -315.7880\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nBIC(fit1, fit2, fit3, fit4)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n     df       BIC\nfit1  3 -309.1429\nfit2  3 -307.7652\nfit3  4 -304.6715\nfit4  4 -304.0030\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n confint(fit1)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n          2.5 %     97.5 %\nma1  -0.7302366 -0.4346864\nsma1 -0.7575456 -0.4108497\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ncheckresiduals(fit1)\n```\n\n::: {.cell-output-display}\n![](test-ts_files/figure-html/unnamed-chunk-22-1.png){width=672}\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n\n\tLjung-Box test\n\ndata:  Residuals from ARIMA(0,1,1)(0,1,1)[12]\nQ* = 18.268, df = 22, p-value = 0.69\n\nModel df: 2.   Total lags used: 24\n```\n:::\n:::\n\n\n- 오차 사이에 자기상관X\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",
    "supporting": [
      "test-ts_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}