<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.335">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="jiyun Lim">
<meta name="dcterms.date" content="2023-02-28">

<title>myblog - 순환신경망 (3)</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-sidebar docked nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">myblog</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link active" href="../../about.html" aria-current="page">
 <span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/pinkocto"><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title">순환신경망 (3)</h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title d-none d-lg-block">순환신경망 (3)</h1>
                                <div class="quarto-categories">
                <div class="quarto-category">DL2022</div>
                <div class="quarto-category">RNN</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>jiyun Lim </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">February 28, 2023</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation docked overflow-auto">
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../about.html" class="sidebar-item-text sidebar-link">About</a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">Etc</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../etc/2023-02-20-memo.html" class="sidebar-item-text sidebar-link">메모장</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../etc/2023-02-28.html" class="sidebar-item-text sidebar-link">클래스 암기</a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">Posts</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="false">DNN</a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/DNN/2023-03-01-dnn1.html" class="sidebar-item-text sidebar-link">딥러닝 기초 (1)</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/DNN/2023-03-01-dnn2.html" class="sidebar-item-text sidebar-link">딥러닝 기초 (2)</a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="false">GCN</a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/GCN/2023-02-27-gcn-prac.html" class="sidebar-item-text sidebar-link">GCN Implementation</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/GCN/2023-02-21-gcn1.html" class="sidebar-item-text sidebar-link">Graph Convolutional Network</a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="false">GNN</a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/GNN/2023-03-03-gnn1.html" class="sidebar-item-text sidebar-link">0 Introductino to GNN</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/GNN/2023-03-04-gnn-intro.html" class="sidebar-item-text sidebar-link">1 GNN tuto1</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/GNN/2023-03-04-gnn2.html" class="sidebar-item-text sidebar-link">2 GNN tuto2</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/GNN/2023-03-04-gnn2_guebin.html" class="sidebar-item-text sidebar-link">2 GNN tuto2</a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true">RNN</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/RNN/2023-02-25-rnn1.html" class="sidebar-item-text sidebar-link">순환신경망 (1)</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/RNN/2023-02-25-rnn2.html" class="sidebar-item-text sidebar-link">순환신경망 (2)</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/RNN/2023-02-28-rnn3.html" class="sidebar-item-text sidebar-link active">순환신경망 (3)</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/RNN/2023-02-28-rnn4.html" class="sidebar-item-text sidebar-link">순환신경망 (4)</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/RNN/2023-03-01-rnn5.html" class="sidebar-item-text sidebar-link">순환신경망 (5)</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/RNN/2023-03-01-rnn6.html" class="sidebar-item-text sidebar-link">순환신경망 (6)</a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="false">STGCN</a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" aria-expanded="false">STGCN 공부</a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-8" class="collapse list-unstyled sidebar-section depth3 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/STGCN/STGCN 공부/traffic_prediction.html" class="sidebar-item-text sidebar-link">Traffic Forecasting review</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/STGCN/STGCN 공부/Untitled.html" class="sidebar-item-text sidebar-link">Untitled</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/STGCN/STGCN 공부/2023-02-21-STGCN-tutorial1.html" class="sidebar-item-text sidebar-link">튜토리얼 따라가기1</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/STGCN/STGCN 공부/2023-02-23-stgcn-tutorial2.html" class="sidebar-item-text sidebar-link">튜토리얼 따라가기2</a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" aria-expanded="false">튜토리얼</a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-9" class="collapse list-unstyled sidebar-section depth3 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/STGCN/튜토리얼/2022-12-29-STGCN-tutorial.html" class="sidebar-item-text sidebar-link">STGCN 튜토리얼</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/STGCN/튜토리얼/2022-12-30-STGCN-Toy Example.html" class="sidebar-item-text sidebar-link">Toy Example</a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-10" aria-expanded="false">Study</a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-10" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-10" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/study/2023-03-05-survey-review.html" class="sidebar-item-text sidebar-link">A Comprehensive Survey on Geometric Deep Learning</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/study/2023-02-25-chap12.2.html" class="sidebar-item-text sidebar-link">Chap 12.2: Weakly Stationary Graph process</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/study/2023-03-05-chap-12.2.1~12.3.1.html" class="sidebar-item-text sidebar-link">Chap 12.2: Weakly Stationary Graph process</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/study/2023-02-24-Chap8.3.html" class="sidebar-item-text sidebar-link">Chap 8.3: Discrete Fourier Transform</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/study/2023-03-07-intro.html" class="sidebar-item-text sidebar-link">측도론 intro</a>
  </div>
</li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-11" aria-expanded="false">ML</a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-11" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-11" class="collapse list-unstyled sidebar-section depth3 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/study/ML/2023-03-03-arima.html" class="sidebar-item-text sidebar-link">ARIMA</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/study/ML/2023-03-09-penaly-regression.html" class="sidebar-item-text sidebar-link">Ridge, Lasso, Elastic Net</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/study/ML/2023-03-05-test27.html" class="sidebar-item-text sidebar-link">Test 27</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/study/ML/test-ts.html" class="sidebar-item-text sidebar-link">time series intro</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/study/ML/2023-03-07-train-valid.html" class="sidebar-item-text sidebar-link">Train/Valid</a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-12" aria-expanded="false">Prof</a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-12" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-12" class="collapse list-unstyled sidebar-section depth3 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/study/prof/2022-12-27-Chap-12.2.1~12.3.1.html" class="sidebar-item-text sidebar-link">Chap 12.2 ~ 3: Power Spectral Density and its Estimators</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/study/prof/2022-12-26-Chap-12.2.html" class="sidebar-item-text sidebar-link">Chap 12.2: Weakly Stationary Graph Processes</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/study/prof/2023-01-15-Chap-12.4.html" class="sidebar-item-text sidebar-link">Chap 12.4: Node Subsampling for PSD Estimation</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/study/prof/2022-12-24-Chap 8.3.html" class="sidebar-item-text sidebar-link">Chap 8.3: Discrete Fourier Transform</a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-13" aria-expanded="true">Tip</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-13" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-13" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Tip/2023-02-20-tips.html" class="sidebar-item-text sidebar-link">download files from Github</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Tip/2023-03-09-github-link.html" class="sidebar-item-text sidebar-link">github 연동</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Tip/2023-02-24-tips.html" class="sidebar-item-text sidebar-link">Julia 연동</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Tip/2023-02-28-link.html" class="sidebar-item-text sidebar-link">some links</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Tip/2023-03-09-linux.html" class="sidebar-item-text sidebar-link">리눅스 명령어</a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#순환신경망-3" id="toc-순환신경망-3" class="nav-link active" data-scroll-target="#순환신경망-3">순환신경망 3</a></li>
  <li><a href="#import" id="toc-import" class="nav-link" data-scroll-target="#import">import</a></li>
  <li><a href="#define-some-functions" id="toc-define-some-functions" class="nav-link" data-scroll-target="#define-some-functions">Define some functions</a></li>
  <li><a href="#예비학습-net.parameters의-의미" id="toc-예비학습-net.parameters의-의미" class="nav-link" data-scroll-target="#예비학습-net.parameters의-의미">예비학습: <code>net.parameters()</code>의 의미</a></li>
  <li><a href="#exam4-abacad2" id="toc-exam4-abacad2" class="nav-link" data-scroll-target="#exam4-abacad2">Exam4: AbAcAd(2)</a>
  <ul class="collapse">
  <li><a href="#data" id="toc-data" class="nav-link" data-scroll-target="#data">data</a></li>
  <li><a href="#실패했던-풀이-구현1" id="toc-실패했던-풀이-구현1" class="nav-link" data-scroll-target="#실패했던-풀이-구현1">실패했던 풀이: 구현1</a>
  <ul class="collapse">
  <li><a href="#네트워크-쪼개기" id="toc-네트워크-쪼개기" class="nav-link" data-scroll-target="#네트워크-쪼개기">네트워크 쪼개기</a></li>
  </ul></li>
  <li><a href="#실패했던-풀이-구현2" id="toc-실패했던-풀이-구현2" class="nav-link" data-scroll-target="#실패했던-풀이-구현2">실패했던 풀이: 구현2</a></li>
  <li><a href="#순환신경망의-아이디어" id="toc-순환신경망의-아이디어" class="nav-link" data-scroll-target="#순환신경망의-아이디어">순환신경망의 아이디어</a>
  <ul class="collapse">
  <li><a href="#모티브" id="toc-모티브" class="nav-link" data-scroll-target="#모티브">모티브</a></li>
  <li><a href="#알고리즘" id="toc-알고리즘" class="nav-link" data-scroll-target="#알고리즘">알고리즘</a></li>
  </ul></li>
  <li><a href="#순환신경망-구현1-with-rnncell-class-hidden-node2---성공" id="toc-순환신경망-구현1-with-rnncell-class-hidden-node2---성공" class="nav-link" data-scroll-target="#순환신경망-구현1-with-rnncell-class-hidden-node2---성공">순환신경망 구현1 (with rNNCell class, hidden node2) - 성공</a></li>
  <li><a href="#순환신경망-구현2-with-rnncell-hidden-node-2---성공" id="toc-순환신경망-구현2-with-rnncell-hidden-node-2---성공" class="nav-link" data-scroll-target="#순환신경망-구현2-with-rnncell-hidden-node-2---성공">순환신경망 구현2 (with RNNCell, hidden node 2) - 성공</a></li>
  </ul></li>
  <li><a href="#숙제" id="toc-숙제" class="nav-link" data-scroll-target="#숙제">숙제</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<section id="순환신경망-3" class="level1">
<h1>순환신경망 3</h1>
<blockquote class="blockquote">
<p>RNN1 - AbAcAd예제(2)</p>
</blockquote>
</section>
<section id="import" class="level1">
<h1>import</h1>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1"></a><span class="im">import</span> torch</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-5"><a href="#cb1-5"></a><span class="im">import</span> time</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="define-some-functions" class="level1">
<h1>Define some functions</h1>
<div class="cell" data-execution_count="41">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1"></a><span class="kw">def</span> f(txt,mapping):</span>
<span id="cb2-2"><a href="#cb2-2"></a>    <span class="cf">return</span> [mapping[key] <span class="cf">for</span> key <span class="kw">in</span> txt]</span>
<span id="cb2-3"><a href="#cb2-3"></a>soft <span class="op">=</span> torch.nn.Softmax(dim<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="예비학습-net.parameters의-의미" class="level1">
<h1>예비학습: <code>net.parameters()</code>의 의미</h1>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1"></a><span class="co"># torch.optim.SGD?</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>-</code> iterator, generator의 개념필요 &gt; <a href="https://pinkocto.github.io/Quarto-Blog/posts/Python/2023-02-23-class8.html">파이썬 iterable object</a></p>
<pre><code>파이썬의 모든 것은 오브젝트이다. 
함수도 오브젝트이고
리스트도 오브젝트이다..</code></pre>
<p><code>-</code> 탐구시작: 네트워크 생성</p>
<div class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1"></a>net <span class="op">=</span> torch.nn.Linear(in_features <span class="op">=</span> <span class="dv">1</span>, out_features<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb5-2"><a href="#cb5-2"></a>net.weight</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="12">
<pre><code>Parameter containing:
tensor([[-0.7051]], requires_grad=True)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1"></a>net.bias</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<pre><code>Parameter containing:
tensor([-0.6763], requires_grad=True)</code></pre>
</div>
</div>
<p><code>-</code> torch.optim.SGD? 를 확인하면 params에 대한 설명에 아래와 같이 되어있음.</p>
<pre><code>params (iterable): iterable of parameters to optimize or dicts defining
        parameter groups</code></pre>
<p><code>-</code> 설명을 읽어보면 params에 iterable object를 넣으라고 되어있음 (ieterable object는 숨겨진 명령어로 <code>__iter__</code>를 가지고 있는 오브젝트를 의미)</p>
<div class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1"></a><span class="bu">set</span>(<span class="bu">dir</span>(net.parameters())) <span class="op">&amp;</span> {<span class="st">'__iter__'</span>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="15">
<pre><code>{'__iter__'}</code></pre>
</div>
</div>
<p><code>-</code> 무슨의미?</p>
<div class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1"></a><span class="cf">for</span> param <span class="kw">in</span> net.parameters():</span>
<span id="cb12-2"><a href="#cb12-2"></a>    <span class="bu">print</span>(param)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Parameter containing:
tensor([[-0.7051]], requires_grad=True)
Parameter containing:
tensor([-0.6763], requires_grad=True)</code></pre>
</div>
</div>
<p><code>-</code> 그냥 이런느낌인데?</p>
<div class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1"></a><span class="cf">for</span> param <span class="kw">in</span> [net.weight, net.bias]:</span>
<span id="cb14-2"><a href="#cb14-2"></a>    <span class="bu">print</span>(param)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Parameter containing:
tensor([[-0.7051]], requires_grad=True)
Parameter containing:
tensor([-0.6763], requires_grad=True)</code></pre>
</div>
</div>
<p><code>-</code> 결론: <code>net.parameters()</code>는 net오브젝트에서 학습할 파라메터를 모두 모아 리스트 같은 iterable object로 만드는 함수라 이해할 수 있다.</p>
<p><code>-</code> 응용예제1</p>
<div class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">"https://raw.githubusercontent.com/guebin/DL2022/master/posts/II.%20DNN/2022-09-22-regression.csv"</span>) </span>
<span id="cb16-2"><a href="#cb16-2"></a>x<span class="op">=</span>torch.tensor(df.x).<span class="bu">float</span>().reshape(<span class="dv">100</span>,<span class="dv">1</span>)</span>
<span id="cb16-3"><a href="#cb16-3"></a>y<span class="op">=</span>torch.tensor(df.y).<span class="bu">float</span>().reshape(<span class="dv">100</span>,<span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1"></a>b <span class="op">=</span> torch.tensor(<span class="op">-</span><span class="fl">5.0</span>, requires_grad<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb17-2"><a href="#cb17-2"></a>w <span class="op">=</span> torch.tensor(<span class="fl">10.0</span>, requires_grad<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb17-3"><a href="#cb17-3"></a>optimizr <span class="op">=</span> torch.optim.SGD([b,w],lr<span class="op">=</span><span class="dv">1</span><span class="op">/</span><span class="dv">10</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1"></a>plt.plot(x,y,<span class="st">'o'</span>)</span>
<span id="cb18-2"><a href="#cb18-2"></a>plt.plot(x,(w<span class="op">*</span>x<span class="op">+</span>b).data,<span class="st">'--'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="2023-02-28-rnn3_files/figure-html/cell-12-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1"></a><span class="cf">for</span> epoc <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">30</span>):</span>
<span id="cb19-2"><a href="#cb19-2"></a>    <span class="co">## step1</span></span>
<span id="cb19-3"><a href="#cb19-3"></a>    yhat <span class="op">=</span> b <span class="op">+</span> w<span class="op">*</span>x</span>
<span id="cb19-4"><a href="#cb19-4"></a>    <span class="co">## step2</span></span>
<span id="cb19-5"><a href="#cb19-5"></a>    loss <span class="op">=</span> torch.mean((y<span class="op">-</span>yhat)<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb19-6"><a href="#cb19-6"></a>    <span class="co">## step3</span></span>
<span id="cb19-7"><a href="#cb19-7"></a>    loss.backward()</span>
<span id="cb19-8"><a href="#cb19-8"></a>    <span class="co">## step4</span></span>
<span id="cb19-9"><a href="#cb19-9"></a>    optimizr.step()</span>
<span id="cb19-10"><a href="#cb19-10"></a>    optimizr.zero_grad()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1"></a>plt.plot(x,y,<span class="st">'o'</span>)</span>
<span id="cb20-2"><a href="#cb20-2"></a>plt.plot(x,(w<span class="op">*</span>x<span class="op">+</span>b).data,<span class="st">'--'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="2023-02-28-rnn3_files/figure-html/cell-14-output-1.png" class="img-fluid"></p>
</div>
</div>
<p><code>-</code> 응용예제2</p>
<div class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">"https://raw.githubusercontent.com/guebin/DL2022/master/posts/II.%20DNN/2022-09-22-regression.csv"</span>) </span>
<span id="cb21-2"><a href="#cb21-2"></a>x <span class="op">=</span> torch.tensor(df.x).<span class="bu">float</span>().reshape(<span class="dv">100</span>,<span class="dv">1</span>)</span>
<span id="cb21-3"><a href="#cb21-3"></a>y <span class="op">=</span> torch.tensor(df.y).<span class="bu">float</span>().reshape(<span class="dv">100</span>,<span class="dv">1</span>)</span>
<span id="cb21-4"><a href="#cb21-4"></a>X <span class="op">=</span> torch.concat([torch.ones_like(x),x],axis<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1"></a>What <span class="op">=</span> torch.tensor([[<span class="op">-</span><span class="fl">5.0</span>],[<span class="fl">10.0</span>]],requires_grad<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb22-2"><a href="#cb22-2"></a>optimizr <span class="op">=</span> torch.optim.SGD([What], lr<span class="op">=</span><span class="dv">1</span><span class="op">/</span><span class="dv">10</span>) <span class="co"># What은 iterable 하지 않지만 [What]은 iterable 함</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="78">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1"></a><span class="co"># optimizr = torch.optim.SGD(What, lr=1/10) # What은 iterable 하지 않음 --&gt; 에러남!</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>iterable을 만드는 가장 쉬운 방법은 리스트를 만드는것! (즉, <strong>iterable object</strong>로 만들자)</li>
<li><strong>What</strong> <span class="math inline">\(\to\)</span> <strong>[What]</strong></li>
</ul>
<div class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1"></a>What</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="32">
<pre><code>tensor([[-5.],
        [10.]], requires_grad=True)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1"></a>plt.plot(x,y,<span class="st">'o'</span>)</span>
<span id="cb26-2"><a href="#cb26-2"></a>plt.plot(x,(X<span class="op">@</span>What).data,<span class="st">'--'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="2023-02-28-rnn3_files/figure-html/cell-19-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="35">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1"></a><span class="cf">for</span> epoc <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">30</span>):</span>
<span id="cb27-2"><a href="#cb27-2"></a>    <span class="co">## step1</span></span>
<span id="cb27-3"><a href="#cb27-3"></a>    yhat <span class="op">=</span> X<span class="op">@</span>What</span>
<span id="cb27-4"><a href="#cb27-4"></a>    <span class="co">## step2</span></span>
<span id="cb27-5"><a href="#cb27-5"></a>    loss <span class="op">=</span> torch.mean((y<span class="op">-</span>yhat)<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb27-6"><a href="#cb27-6"></a>    <span class="co">## step3</span></span>
<span id="cb27-7"><a href="#cb27-7"></a>    loss.backward()</span>
<span id="cb27-8"><a href="#cb27-8"></a>    <span class="co">## step4</span></span>
<span id="cb27-9"><a href="#cb27-9"></a>    optimizr.step()</span>
<span id="cb27-10"><a href="#cb27-10"></a>    optimizr.zero_grad()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="36">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1"></a>plt.plot(x,y,<span class="st">'o'</span>)</span>
<span id="cb28-2"><a href="#cb28-2"></a>plt.plot(x,(X<span class="op">@</span>What).data,<span class="st">'--'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="2023-02-28-rnn3_files/figure-html/cell-21-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="exam4-abacad2" class="level1">
<h1>Exam4: AbAcAd(2)</h1>
<div class="cell" data-execution_count="42">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1"></a><span class="kw">def</span> f(txt,mapping):</span>
<span id="cb29-2"><a href="#cb29-2"></a>    <span class="cf">return</span> [mapping[key] <span class="cf">for</span> key <span class="kw">in</span> txt]</span>
<span id="cb29-3"><a href="#cb29-3"></a>soft <span class="op">=</span> torch.nn.Softmax(dim<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="data" class="level2">
<h2 class="anchored" data-anchor-id="data">data</h2>
<p><code>-</code> 기존의 정리방식</p>
<div class="cell" data-execution_count="55">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1"></a>txt <span class="op">=</span> <span class="bu">list</span>(<span class="st">'AbAcAd'</span>)<span class="op">*</span><span class="dv">100</span></span>
<span id="cb30-2"><a href="#cb30-2"></a>txt[:<span class="dv">10</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="55">
<pre><code>['A', 'b', 'A', 'c', 'A', 'd', 'A', 'b', 'A', 'c']</code></pre>
</div>
</div>
<div class="cell" data-execution_count="56">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1"></a>txt_x <span class="op">=</span> txt[:<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb32-2"><a href="#cb32-2"></a>txt_y <span class="op">=</span> txt[<span class="dv">1</span>:]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="57">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1"></a>txt_x[:<span class="dv">5</span>], txt_y[:<span class="dv">5</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="57">
<pre><code>(['A', 'b', 'A', 'c', 'A'], ['b', 'A', 'c', 'A', 'd'])</code></pre>
</div>
</div>
<div class="cell" data-execution_count="58">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1"></a>x <span class="op">=</span> torch.tensor(f(txt_x,{<span class="st">'A'</span>:<span class="dv">0</span>,<span class="st">'b'</span>:<span class="dv">1</span>,<span class="st">'c'</span>:<span class="dv">2</span>,<span class="st">'d'</span>:<span class="dv">3</span>}))</span>
<span id="cb35-2"><a href="#cb35-2"></a>y <span class="op">=</span> torch.tensor(f(txt_y,{<span class="st">'A'</span>:<span class="dv">0</span>,<span class="st">'b'</span>:<span class="dv">1</span>,<span class="st">'c'</span>:<span class="dv">2</span>,<span class="st">'d'</span>:<span class="dv">3</span>}))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="59">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1"></a>x[:<span class="dv">8</span>], y[:<span class="dv">8</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="59">
<pre><code>(tensor([0, 1, 0, 2, 0, 3, 0, 1]), tensor([1, 0, 2, 0, 3, 0, 1, 0]))</code></pre>
</div>
</div>
<p><code>-</code> 이번에는 원핫인코딩 형태까지 미리 정의하자. (임베딩 레이어 안쓸예정)</p>
<div class="cell" data-execution_count="60">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1"></a>x<span class="op">=</span> torch.nn.functional.one_hot(x).<span class="bu">float</span>()</span>
<span id="cb38-2"><a href="#cb38-2"></a>y<span class="op">=</span> torch.nn.functional.one_hot(y).<span class="bu">float</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="61">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1"></a>x, y</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="61">
<pre><code>(tensor([[1., 0., 0., 0.],
         [0., 1., 0., 0.],
         [1., 0., 0., 0.],
         ...,
         [1., 0., 0., 0.],
         [0., 0., 1., 0.],
         [1., 0., 0., 0.]]),
 tensor([[0., 1., 0., 0.],
         [1., 0., 0., 0.],
         [0., 0., 1., 0.],
         ...,
         [0., 0., 1., 0.],
         [1., 0., 0., 0.],
         [0., 0., 0., 1.]]))</code></pre>
</div>
</div>
</section>
<section id="실패했던-풀이-구현1" class="level2">
<h2 class="anchored" data-anchor-id="실패했던-풀이-구현1">실패했던 풀이: 구현1</h2>
<p><code>-</code> 저번시간의 실패한 풀이</p>
<div class="cell" data-execution_count="63">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1"></a>torch.manual_seed(<span class="dv">43052</span>)</span>
<span id="cb41-2"><a href="#cb41-2"></a>net <span class="op">=</span> torch.nn.Sequential(</span>
<span id="cb41-3"><a href="#cb41-3"></a>    torch.nn.Embedding(num_embeddings<span class="op">=</span><span class="dv">4</span>, embedding_dim<span class="op">=</span><span class="dv">2</span>), <span class="co">##</span></span>
<span id="cb41-4"><a href="#cb41-4"></a>    torch.nn.Tanh(), <span class="co">##</span></span>
<span id="cb41-5"><a href="#cb41-5"></a>    torch.nn.Linear(in_featusre<span class="op">=</span><span class="dv">2</span>, out_features<span class="op">=</span><span class="dv">4</span>)</span>
<span id="cb41-6"><a href="#cb41-6"></a>)</span>
<span id="cb41-7"><a href="#cb41-7"></a>loss_fn <span class="op">=</span> torch.nn.CrossEntropyLoss()</span>
<span id="cb41-8"><a href="#cb41-8"></a>optimizr <span class="op">=</span> torch.optim.Adam(net.parameters())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="네트워크-쪼개기" class="level3">
<h3 class="anchored" data-anchor-id="네트워크-쪼개기">네트워크 쪼개기</h3>
<p><code>-</code> Tanh까지만 클래스로 바꾸어서 구현</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1"></a><span class="co">## step1. 요 두줄 따로 떼네서 요부분만 수행하는 네트워크를 따로만들고 (Hnet)</span></span>
<span id="cb42-2"><a href="#cb42-2"></a>torch.nn.Embedding(num_embeddings<span class="op">=</span><span class="dv">4</span>, embedding_dim<span class="op">=</span><span class="dv">2</span>),</span>
<span id="cb42-3"><a href="#cb42-3"></a>torch.nn.Tanh(),</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb43"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1"></a><span class="co">## step2. 밑에있는 linear를 수행하는 네트워크를 따로 만들 것이다.</span></span>
<span id="cb43-2"><a href="#cb43-2"></a>torch.nn.Linear(in_featusre<span class="op">=</span><span class="dv">2</span>, out_features<span class="op">=</span><span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb44"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1"></a><span class="co">## step3. 이렇게 2개의 네트워크를 만들고, 2개의 네트워크에 해당되는 파라미터들을 전달해서 학습을 시킬 것</span></span>
<span id="cb44-2"><a href="#cb44-2"></a></span>
<span id="cb44-3"><a href="#cb44-3"></a><span class="co">## + 2개의 네트워크로 쪼개서 파라미터를 각각 리스트 형태로 전달할 것이기 때문에 위에서 한 예비학습이 필요했다.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell" data-execution_count="86">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1"></a><span class="kw">class</span> Hnet(torch.nn.Module):</span>
<span id="cb45-2"><a href="#cb45-2"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>):</span>
<span id="cb45-3"><a href="#cb45-3"></a>        <span class="bu">super</span>().<span class="fu">__init__</span>()</span>
<span id="cb45-4"><a href="#cb45-4"></a>        <span class="co">## 우리가 사용할 레이어를 정의</span></span>
<span id="cb45-5"><a href="#cb45-5"></a>        <span class="va">self</span>.i2h <span class="op">=</span> torch.nn.Linear(in_features<span class="op">=</span><span class="dv">4</span>, out_features<span class="op">=</span><span class="dv">2</span>) <span class="co"># input(x) -&gt; h</span></span>
<span id="cb45-6"><a href="#cb45-6"></a>        <span class="va">self</span>.tanh <span class="op">=</span> torch.nn.Tanh()</span>
<span id="cb45-7"><a href="#cb45-7"></a>        <span class="co">## 레이어 정의 끝</span></span>
<span id="cb45-8"><a href="#cb45-8"></a>    <span class="kw">def</span> forward(<span class="va">self</span>,x):</span>
<span id="cb45-9"><a href="#cb45-9"></a>        <span class="co">## yhat을 어떻게 구현할것인지 정의</span></span>
<span id="cb45-10"><a href="#cb45-10"></a>        hidden <span class="op">=</span> <span class="va">self</span>.tanh(<span class="va">self</span>.i2h(x))</span>
<span id="cb45-11"><a href="#cb45-11"></a>        <span class="co">## 정의 끝</span></span>
<span id="cb45-12"><a href="#cb45-12"></a>        <span class="cf">return</span> hidden</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="87">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1"></a>hnet <span class="op">=</span> Hnet()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="88">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1"></a>hnet</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="88">
<pre><code>Hnet(
  (i2h): Linear(in_features=4, out_features=2, bias=True)
  (tanh): Tanh()
)</code></pre>
</div>
</div>
<p><code>-</code> for문 돌릴준비</p>
<div class="cell" data-execution_count="89">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1"></a><span class="co"># 옵티마이저에 자칭 신기술 적용!!!</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="68">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1"></a>torch.manual_seed(<span class="dv">43052</span>) </span>
<span id="cb50-2"><a href="#cb50-2"></a>hnet <span class="op">=</span> Hnet()</span>
<span id="cb50-3"><a href="#cb50-3"></a>linr <span class="op">=</span> torch.nn.Linear(in_features<span class="op">=</span><span class="dv">2</span>,out_features<span class="op">=</span><span class="dv">4</span>)</span>
<span id="cb50-4"><a href="#cb50-4"></a>loss_fn <span class="op">=</span> torch.nn.CrossEntropyLoss() </span>
<span id="cb50-5"><a href="#cb50-5"></a>optimizr <span class="op">=</span> torch.optim.Adam(<span class="bu">list</span>(hnet.parameters())<span class="op">+</span><span class="bu">list</span>(linr.parameters())) <span class="co">## 학습하고 싶은 파라미터 모으기</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>-</code> for문 20회반복</p>
<div class="cell" data-execution_count="69">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1"></a><span class="cf">for</span> epoc <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">20</span>): </span>
<span id="cb51-2"><a href="#cb51-2"></a>    <span class="co">## 1 </span></span>
<span id="cb51-3"><a href="#cb51-3"></a>    <span class="co">## 2 </span></span>
<span id="cb51-4"><a href="#cb51-4"></a>    hidden <span class="op">=</span> hnet(x) </span>
<span id="cb51-5"><a href="#cb51-5"></a>    output <span class="op">=</span> linr(hidden)</span>
<span id="cb51-6"><a href="#cb51-6"></a>    loss <span class="op">=</span> loss_fn(output,y)</span>
<span id="cb51-7"><a href="#cb51-7"></a>    <span class="co">## 3 </span></span>
<span id="cb51-8"><a href="#cb51-8"></a>    loss.backward()</span>
<span id="cb51-9"><a href="#cb51-9"></a>    <span class="co">## 4 </span></span>
<span id="cb51-10"><a href="#cb51-10"></a>    optimizr.step()</span>
<span id="cb51-11"><a href="#cb51-11"></a>    optimizr.zero_grad()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>-</code> linr(hnet(x)) 적합결과 &lt;- 숫자체크</p>
<div class="cell" data-execution_count="70">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1"></a>linr(hnet(x)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="70">
<pre><code>tensor([[-0.3589,  0.7921, -0.1970, -0.0302],
        [-0.2912,  0.8140, -0.2032,  0.0178],
        [-0.3589,  0.7921, -0.1970, -0.0302],
        ...,
        [-0.3589,  0.7921, -0.1970, -0.0302],
        [-0.1065,  0.6307, -0.0874,  0.1821],
        [-0.3589,  0.7921, -0.1970, -0.0302]], grad_fn=&lt;AddmmBackward0&gt;)</code></pre>
</div>
</div>
</section>
</section>
<section id="실패했던-풀이-구현2" class="level2">
<h2 class="anchored" data-anchor-id="실패했던-풀이-구현2">실패했던 풀이: 구현2</h2>
<p><code>-</code> Tanh까지 구현한 클래스</p>
<div class="cell" data-execution_count="71">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1"></a><span class="co"># class Hnet(torch.nn.Module):</span></span>
<span id="cb54-2"><a href="#cb54-2"></a><span class="co">#     def __init__(self):</span></span>
<span id="cb54-3"><a href="#cb54-3"></a><span class="co">#         super().__init__()</span></span>
<span id="cb54-4"><a href="#cb54-4"></a><span class="co">#         self.i2h = torch.nn.Linear(in_features=4,out_features=2)</span></span>
<span id="cb54-5"><a href="#cb54-5"></a><span class="co">#         self.tanh = torch.nn.Tanh()</span></span>
<span id="cb54-6"><a href="#cb54-6"></a><span class="co">#     def forward(self,x):</span></span>
<span id="cb54-7"><a href="#cb54-7"></a><span class="co">#         hidden = self.tanh(self.i2h(x))</span></span>
<span id="cb54-8"><a href="#cb54-8"></a><span class="co">#         return hidden</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>-</code> for문돌릴준비</p>
<div class="cell" data-execution_count="73">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1"></a>torch.manual_seed(<span class="dv">43052</span>)</span>
<span id="cb55-2"><a href="#cb55-2"></a>hnet <span class="op">=</span> Hnet()</span>
<span id="cb55-3"><a href="#cb55-3"></a>linr <span class="op">=</span> torch.nn.Linear(in_features<span class="op">=</span><span class="dv">2</span>, out_features<span class="op">=</span><span class="dv">4</span>)</span>
<span id="cb55-4"><a href="#cb55-4"></a>loss_fn <span class="op">=</span> torch.nn.CrossEntropyLoss()</span>
<span id="cb55-5"><a href="#cb55-5"></a>optimizr <span class="op">=</span> torch.optim.Adam(<span class="bu">list</span>(hnet.parameters()) <span class="op">+</span> <span class="bu">list</span>(linr.parameters()))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>-</code> for문: 20회반복</p>
<div class="cell" data-execution_count="90">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1"></a><span class="bu">len</span>(x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="90">
<pre><code>599</code></pre>
</div>
</div>
<div class="cell" data-execution_count="93">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1"></a>hnet(x[<span class="dv">0</span>]), hnet(x[[<span class="dv">0</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="93">
<pre><code>(tensor([-0.4504,  0.6483], grad_fn=&lt;TanhBackward0&gt;),
 tensor([[-0.4504,  0.6483]], grad_fn=&lt;TanhBackward0&gt;))</code></pre>
</div>
</div>
<div class="cell" data-execution_count="74">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1"></a>T <span class="op">=</span> <span class="bu">len</span>(x) </span>
<span id="cb60-2"><a href="#cb60-2"></a><span class="cf">for</span> epoc <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">20</span>): </span>
<span id="cb60-3"><a href="#cb60-3"></a>    <span class="co">## 1~2</span></span>
<span id="cb60-4"><a href="#cb60-4"></a>    loss <span class="op">=</span> <span class="dv">0</span> </span>
<span id="cb60-5"><a href="#cb60-5"></a>    <span class="cf">for</span> t <span class="kw">in</span> <span class="bu">range</span>(T):</span>
<span id="cb60-6"><a href="#cb60-6"></a>        xt,yt <span class="op">=</span> x[[t]], y[[t]]</span>
<span id="cb60-7"><a href="#cb60-7"></a>        ht <span class="op">=</span> hnet(xt)   <span class="co"># hidden </span></span>
<span id="cb60-8"><a href="#cb60-8"></a>        ot <span class="op">=</span> linr(ht)  <span class="co"># 하나의 observation에 대한 output</span></span>
<span id="cb60-9"><a href="#cb60-9"></a>        loss <span class="op">=</span> loss <span class="op">+</span> loss_fn(ot,yt)  <span class="co"># loss를 누적.</span></span>
<span id="cb60-10"><a href="#cb60-10"></a>    <span class="co">## 3 </span></span>
<span id="cb60-11"><a href="#cb60-11"></a>    loss.backward()</span>
<span id="cb60-12"><a href="#cb60-12"></a>    <span class="co">## 4 </span></span>
<span id="cb60-13"><a href="#cb60-13"></a>    optimizr.step()</span>
<span id="cb60-14"><a href="#cb60-14"></a>    optimizr.zero_grad()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>-</code> linr(hnet(x)) 적합결과 &lt;- 숫자체크</p>
<div class="cell" data-execution_count="75">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1"></a>linr(hnet(x))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="75">
<pre><code>tensor([[-0.3589,  0.7921, -0.1970, -0.0302],
        [-0.2912,  0.8140, -0.2032,  0.0178],
        [-0.3589,  0.7921, -0.1970, -0.0302],
        ...,
        [-0.3589,  0.7921, -0.1970, -0.0302],
        [-0.1065,  0.6307, -0.0874,  0.1821],
        [-0.3589,  0.7921, -0.1970, -0.0302]], grad_fn=&lt;AddmmBackward0&gt;)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="95">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1"></a>x <span class="co"># n x 4</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="95">
<pre><code>tensor([[1., 0., 0., 0.],
        [0., 1., 0., 0.],
        [1., 0., 0., 0.],
        ...,
        [1., 0., 0., 0.],
        [0., 0., 1., 0.],
        [1., 0., 0., 0.]])</code></pre>
</div>
</div>
</section>
<section id="순환신경망의-아이디어" class="level2">
<h2 class="anchored" data-anchor-id="순환신경망의-아이디어">순환신경망의 아이디어</h2>
<section id="모티브" class="level3">
<h3 class="anchored" data-anchor-id="모티브">모티브</h3>
<p><strong><em>(예비생각1) h에 대한 이해</em></strong></p>
<p>는 사실 문자열 ’abcd’들을 숫자로 바꾼 또 다른 형식의 숫자표현이라 해석할 수 있음. 즉 원핫인코딩과 다른 또 다른 형태의 숫자표현이라 해석할 수 있다. (사실 원핫인코딩보다 약간 더 (1) 액기스만 남은 느낌 + (2) 숙성된 느낌을 준다)</p>
<ul>
<li><p>(why1) h는 “학습을 용이하게 하기 위해서 x를 적당히 선형적으로 전처리한 상태”라고 이해가능</p></li>
<li><p>(why2) 실제로 예시를 살펴보면 그러했다</p></li>
</ul>
<p><strong><em>(예비생각2) 수백년전통을 이어가는 방법</em></strong></p>
<pre><code>“1리터에 500만원에 낙찰된 적 있습니다.”
“2kg에 1억원 정도 추산됩니다.”
“20여 종 종자장을 블렌딩해 100ml에 5000만원씩 분양 예정입니다.”

모두 씨간장(종자장) 가격에 관한 실제 일화다.

(중략...)

위스키나 와인처럼 블렌딩을 하기도 한다. 
새로 담근 간장에 씨간장을 넣거나, 씨간장독에 햇간장을 넣어 맛을 유지하기도 한다. 
이를 겹장(또는 덧장)이라 한다. 
몇몇 종갓집에선 씨간장 잇기를 몇백 년째 해오고 있다. 
매년 새로 간장을 담가야 이어갈 수 있으니 불씨 꺼트리지 않는 것처럼 굉장히 어려운 일이다.
이렇게 하는 이유는 집집마다 내려오는 고유 장맛을 잃지 않기 위함이다. 
씨간장이란 그만큼 소중한 주방의 자산이며 정체성이다.</code></pre>
<p>덧장: 새로운 간장을 만들 때, 옛날간장을 섞어서 만듦.</p>
<p><code>*</code> 기존방식: <span class="math inline">\(\text{콩물} \overset{\text{숙성}}{\longrightarrow} \text{간장}\)</span></p>
<p><code>*</code> 수백년 전통의 간장맛을 유지하는 방식</p>
<ul>
<li><span class="math inline">\(\text{콩물}_1 \overset{\text{숙성}}{\longrightarrow} \text{간장}_1\)</span></li>
<li><span class="math inline">\(\text{콩물}_2, \text{간장}_1 \overset{\text{숙성}}{\longrightarrow} \text{간장}_2\)</span></li>
<li><span class="math inline">\(\text{콩물}_3, \text{간장}_2 \overset{\text{숙성}}{\longrightarrow} \text{간장}_3\)</span></li>
</ul>
<p><code>*</code> 수백년 전통의 간장맛을 유지하면서 조리를 한다면?</p>
<ul>
<li><p><span class="math inline">\(\text{콩물}_1 \overset{\text{숙성}}{\longrightarrow} \text{간장}_1 \overset{\text{조리}}{\longrightarrow} \text{간장계란밥}_1\)</span></p></li>
<li><p><span class="math inline">\(\text{콩물}_2, \text{간장}_1 \overset{\text{숙성}}{\longrightarrow} \text{간장}_2 \overset{\text{조리}}{\longrightarrow} \text{간장계란밥}_2\)</span></p></li>
<li><p><span class="math inline">\(\text{콩물}_3, \text{간장}_2 \overset{\text{숙성}}{\longrightarrow} \text{간장}_3 \overset{\text{조리}}{\longrightarrow} \text{간장계란밥}_3\)</span></p></li>
</ul>
<p>점점 맛있는 간장계란밥이 탄생함.</p>
<p><code>*</code> 알고리즘 편의상 아래와 같이 생각해도 무방.</p>
<ul>
<li><p><span class="math inline">\(\text{콩물}_1, \text{간장}_0 \overset{\text{숙성}}{\longrightarrow} \text{간장}_1 \overset{\text{조리}}{\longrightarrow} \text{간장계란밥}_1 ,\quad \text{간장}_0=\text{맹물}\)</span></p></li>
<li><p><span class="math inline">\(\text{콩물}_2, \text{간장}_1 \overset{\text{숙성}}{\longrightarrow} \text{간장}_2 \overset{\text{조리}}{\longrightarrow} \text{간장계란밥}_2\)</span></p></li>
<li><p><span class="math inline">\(\text{콩물}_3, \text{간장}_2 \overset{\text{숙성}}{\longrightarrow} \text{간장}_3 \overset{\text{조리}}{\longrightarrow} \text{간장계란밥}_3\)</span></p></li>
</ul>
<p><strong><em>아이디어</em></strong></p>
<p><code>*</code> 수백년 전통의 간장맛을 유지하면서 조리하는 과정을 수식으로?</p>
<ul>
<li><p><span class="math inline">\(\boldsymbol{x}_1, \boldsymbol{h}_0 \overset{\text{숙성}}{\longrightarrow} \boldsymbol{h}_1 \overset{\text{조리}}{\longrightarrow} \hat{\boldsymbol y}_1\)</span></p></li>
<li><p><span class="math inline">\(\boldsymbol{x}_2, \boldsymbol{h}_1 \overset{\text{숙성}}{\longrightarrow} \boldsymbol{h}_2 \overset{\text{조리}}{\longrightarrow} \hat{\boldsymbol y}_2\)</span></p></li>
<li><p><span class="math inline">\(\boldsymbol{x}_3, \boldsymbol{h}_2 \overset{\text{숙성}}{\longrightarrow} \boldsymbol{h}_3 \overset{\text{조리}}{\longrightarrow} \hat{\boldsymbol y}_3\)</span></p></li>
</ul>
<p>이제 우리가 배울것은 (1)“<span class="math inline">\(\text{콩물}_{t}\)</span>”와 “<span class="math inline">\(\text{간장}_{t-1}\)</span>”로 “<span class="math inline">\(\text{간장}_{t}\)</span>”를 <code>숙성</code>하는 방법 (2) “<span class="math inline">\(\text{간장}_{t}\)</span>”으로 “<span class="math inline">\(\text{간장계란밥}_{t}\)</span>”을 <code>조리</code>하는 방법이다.</p>
<p>즉 <code>숙성</code>담당 네트워크와 <code>조리</code>담당 네트워크를 각각 만들어 학습하면 된다.</p>
</section>
<section id="알고리즘" class="level3">
<h3 class="anchored" data-anchor-id="알고리즘">알고리즘</h3>
<p><strong><em>세부적인 알고리즘(<span class="math inline">\(t=0,1,2,\dots\)</span>에 대하여 한줄 한줄 쓴 알고리즘)</em></strong></p>
<p><code>(1)</code> <span class="math inline">\(t=0\)</span></p>
<p><span class="math inline">\({\boldsymbol h}_0=[[0,0]] \leftarrow \text{간장}_0\)</span>은 맹물로 초기화</p>
<p><code>(2)</code> <span class="math inline">\(t=1\)</span></p>
<p><span class="math inline">\({\boldsymbol h}_1= \tanh({\boldsymbol x}_1{\bf W}_{ih}+{\boldsymbol h}_0{\bf W}_{hh}+{\boldsymbol b}_{ih}+{\boldsymbol b}_{hh})\)</span></p>
<ul>
<li><p><span class="math inline">\({\boldsymbol x}_1: (1,4)\)</span></p></li>
<li><p><span class="math inline">\({\bf W}_{ih}: (4,2)\)</span></p></li>
<li><p><span class="math inline">\({\boldsymbol h}_0: (1,2)\)</span></p></li>
<li><p><span class="math inline">\({\bf W}_hh: (2,2)\)</span></p></li>
<li><p><span class="math inline">\({\boldsymbol b}_{ih}: (1,2)\)</span></p></li>
<li><p><span class="math inline">\({\boldsymbol b}_{hh}: (1,2)\)</span></p></li>
</ul>
<p><span class="math inline">\({\boldsymbol o}_1= {\bf W}_{ho}{\boldsymbol h}_1+{\boldsymbol b}_{ho}\)</span></p>
<p><span class="math inline">\(\hat{\boldsymbol y}_1 = \text{soft}({\boldsymbol o}_1)\)</span></p>
<hr>
<p><strong>좀 더 일반화된 알고리즘</strong></p>
<p><strong><em>(ver1)</em></strong></p>
<p>init <span class="math inline">\(\boldsymbol{h}_0\)</span></p>
<p>for <span class="math inline">\(t\)</span> in <span class="math inline">\(1\)</span>:<span class="math inline">\(T\)</span></p>
<ul>
<li><p><span class="math inline">\({\boldsymbol h}_t= \tanh({\boldsymbol x}_t{\bf W}_{ih}+{\boldsymbol h}_{t-1}{\bf W}_{hh}+{\boldsymbol b}_{ih}+{\boldsymbol b}_{hh})\)</span></p></li>
<li><p><span class="math inline">\({\boldsymbol o}_t= {\bf W}_{ho}{\boldsymbol h}_1+{\boldsymbol b}_{ho}\)</span></p></li>
<li><p><span class="math inline">\(\hat{\boldsymbol y}_t = \text{soft}({\boldsymbol o}_t)\)</span></p></li>
</ul>
<p><strong><em>(ver2)</em></strong></p>
<div class="sourceCode" id="cb66"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1"></a>init hidden</span>
<span id="cb66-2"><a href="#cb66-2"></a></span>
<span id="cb66-3"><a href="#cb66-3"></a><span class="cf">for</span> t <span class="kw">in</span> <span class="dv">1</span>:T </span>
<span id="cb66-4"><a href="#cb66-4"></a>    hidden <span class="op">=</span> tanh(linr(x)<span class="op">+</span>linr(hidden))</span>
<span id="cb66-5"><a href="#cb66-5"></a>    output <span class="op">=</span> linr(hidden)</span>
<span id="cb66-6"><a href="#cb66-6"></a>    yt_hat <span class="op">=</span> soft(output)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>코드상으로는 <span class="math inline">\(h_t\)</span>와 <span class="math inline">\(h_{t-1}\)</span>의 구분이 교묘하게 사라진다. (그래서 오히려 좋아.)</li>
</ul>
<hr>
<p><strong><em>전체 알고리즘은 대충 아래와 같은 형식으로 구현될 수 있음.</em></strong></p>
<div class="sourceCode" id="cb67"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1"></a><span class="kw">class</span> rNNCell(torch.nn.Module):</span>
<span id="cb67-2"><a href="#cb67-2"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>):</span>
<span id="cb67-3"><a href="#cb67-3"></a>        <span class="bu">super</span>().<span class="fu">__init__</span>()</span>
<span id="cb67-4"><a href="#cb67-4"></a>        linr1 <span class="op">=</span> torch.nn.Linear(?,?) </span>
<span id="cb67-5"><a href="#cb67-5"></a>        linr2 <span class="op">=</span> torch.nn.Linear(?,?) </span>
<span id="cb67-6"><a href="#cb67-6"></a>        tanh <span class="op">=</span> torch.nn.Tanh()</span>
<span id="cb67-7"><a href="#cb67-7"></a>    <span class="kw">def</span> forward(<span class="va">self</span>,x,hidden):</span>
<span id="cb67-8"><a href="#cb67-8"></a>        hidden <span class="op">=</span> tanh(lrnr1(x)<span class="op">+</span>lrnr2(hidden))</span>
<span id="cb67-9"><a href="#cb67-9"></a>        <span class="cf">return</span> hidden</span>
<span id="cb67-10"><a href="#cb67-10"></a></span>
<span id="cb67-11"><a href="#cb67-11"></a>init ht</span>
<span id="cb67-12"><a href="#cb67-12"></a>rnncell <span class="op">=</span> rNNCell()</span>
<span id="cb67-13"><a href="#cb67-13"></a></span>
<span id="cb67-14"><a href="#cb67-14"></a><span class="cf">for</span> t <span class="kw">in</span> <span class="dv">1</span>:T </span>
<span id="cb67-15"><a href="#cb67-15"></a>    xt, yt <span class="op">=</span> x[[t]], y[[t]] </span>
<span id="cb67-16"><a href="#cb67-16"></a>    ht <span class="op">=</span> rnncell(xt, ht)</span>
<span id="cb67-17"><a href="#cb67-17"></a>    ot <span class="op">=</span> linr(ht) </span>
<span id="cb67-18"><a href="#cb67-18"></a>    loss <span class="op">=</span> loss <span class="op">+</span> loss_fn(ot, yt)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="순환신경망-구현1-with-rnncell-class-hidden-node2---성공" class="level2">
<h2 class="anchored" data-anchor-id="순환신경망-구현1-with-rnncell-class-hidden-node2---성공">순환신경망 구현1 (with rNNCell class, hidden node2) - 성공</h2>
<p><code>(1)</code> 숙성담당 네트워크</p>
<div class="cell" data-execution_count="122">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1"></a><span class="kw">class</span> rNNCell(torch.nn.Module):</span>
<span id="cb68-2"><a href="#cb68-2"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>):</span>
<span id="cb68-3"><a href="#cb68-3"></a>        <span class="bu">super</span>().<span class="fu">__init__</span>()</span>
<span id="cb68-4"><a href="#cb68-4"></a>        <span class="va">self</span>.i2h <span class="op">=</span> torch.nn.Linear(<span class="dv">4</span>,<span class="dv">2</span>) </span>
<span id="cb68-5"><a href="#cb68-5"></a>        <span class="va">self</span>.h2h <span class="op">=</span> torch.nn.Linear(<span class="dv">2</span>,<span class="dv">2</span>) </span>
<span id="cb68-6"><a href="#cb68-6"></a>        <span class="va">self</span>.tanh <span class="op">=</span> torch.nn.Tanh()</span>
<span id="cb68-7"><a href="#cb68-7"></a>    <span class="kw">def</span> forward(<span class="va">self</span>,x,hidden):</span>
<span id="cb68-8"><a href="#cb68-8"></a>        hidden <span class="op">=</span> <span class="va">self</span>.tanh(<span class="va">self</span>.i2h(x)<span class="op">+</span><span class="va">self</span>.h2h(hidden))</span>
<span id="cb68-9"><a href="#cb68-9"></a>        <span class="cf">return</span> hidden</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="123">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1"></a>torch.manual_seed(<span class="dv">43052</span>)</span>
<span id="cb69-2"><a href="#cb69-2"></a>rnncell <span class="op">=</span>  rNNCell() <span class="co"># 숙성담당 네트워크 (콩물 -&gt; 간장), h를 만드는 네트워크.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>(2)</code> 조리담당 네트워크</p>
<div class="cell" data-execution_count="124">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1"></a>torch.manual_seed(<span class="dv">43052</span>)</span>
<span id="cb70-2"><a href="#cb70-2"></a>cook <span class="op">=</span> torch.nn.Linear(<span class="dv">2</span>,<span class="dv">4</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>(3)</code> 손실함수, 옵티마이저 설계</p>
<div class="cell" data-execution_count="125">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1"></a>loss_fn <span class="op">=</span> torch.nn.CrossEntropyLoss() </span>
<span id="cb71-2"><a href="#cb71-2"></a>optimizr <span class="op">=</span> torch.optim.Adam(<span class="bu">list</span>(rnncell.parameters())<span class="op">+</span><span class="bu">list</span>(cook.parameters()))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>(4)</code> 학습 (6분정도 걸림)</p>
<div class="cell" data-execution_count="126">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1"></a>T <span class="op">=</span> <span class="bu">len</span>(x) </span>
<span id="cb72-2"><a href="#cb72-2"></a><span class="cf">for</span> epoc <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">5000</span>): </span>
<span id="cb72-3"><a href="#cb72-3"></a>    <span class="co">## 1~2</span></span>
<span id="cb72-4"><a href="#cb72-4"></a>    loss <span class="op">=</span> <span class="dv">0</span> </span>
<span id="cb72-5"><a href="#cb72-5"></a>    ht <span class="op">=</span> torch.zeros(<span class="dv">1</span>,<span class="dv">2</span>) <span class="co"># 1x2 맹물벡터</span></span>
<span id="cb72-6"><a href="#cb72-6"></a>    <span class="cf">for</span> t <span class="kw">in</span> <span class="bu">range</span>(T):</span>
<span id="cb72-7"><a href="#cb72-7"></a>        xt,yt <span class="op">=</span> x[[t]], y[[t]]</span>
<span id="cb72-8"><a href="#cb72-8"></a>        ht <span class="op">=</span> rnncell(xt,ht) <span class="co"># 숙성된 애가 들어가서 ht가 만들어짐.</span></span>
<span id="cb72-9"><a href="#cb72-9"></a>        ot <span class="op">=</span> cook(ht) <span class="co"># ht가 cook을 거쳐서 ot가 됨.</span></span>
<span id="cb72-10"><a href="#cb72-10"></a>        loss <span class="op">=</span> loss <span class="op">+</span> loss_fn(ot,yt) </span>
<span id="cb72-11"><a href="#cb72-11"></a>    <span class="co">## 3 </span></span>
<span id="cb72-12"><a href="#cb72-12"></a>    loss.backward()</span>
<span id="cb72-13"><a href="#cb72-13"></a>    <span class="co">## 4 </span></span>
<span id="cb72-14"><a href="#cb72-14"></a>    optimizr.step()</span>
<span id="cb72-15"><a href="#cb72-15"></a>    optimizr.zero_grad()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>(5)</code> 시각화</p>
<div class="cell" data-execution_count="127">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1"></a>T <span class="op">=</span> <span class="bu">len</span>(x) </span>
<span id="cb73-2"><a href="#cb73-2"></a>hidden <span class="op">=</span> torch.zeros(T,<span class="dv">2</span>) <span class="co"># 599년치 h를 담을 변수 </span></span>
<span id="cb73-3"><a href="#cb73-3"></a>_water <span class="op">=</span> torch.zeros(<span class="dv">1</span>,<span class="dv">2</span>) <span class="co"># 맹물 </span></span>
<span id="cb73-4"><a href="#cb73-4"></a>hidden[[<span class="dv">0</span>]] <span class="op">=</span> rnncell(x[[<span class="dv">0</span>]],_water) <span class="co"># x에 맹물을 넣어 첫번째 간장을 만든다.</span></span>
<span id="cb73-5"><a href="#cb73-5"></a><span class="cf">for</span> t <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>,T):</span>
<span id="cb73-6"><a href="#cb73-6"></a>    hidden[[t]] <span class="op">=</span> rnncell(x[[t]],hidden[[t<span class="op">-</span><span class="dv">1</span>]]) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="128">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1"></a>yhat <span class="op">=</span> soft(cook(hidden)) <span class="co"># 간장을 가지고 조리한 것을 softmax 취한다.</span></span>
<span id="cb74-2"><a href="#cb74-2"></a>yhat</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="128">
<pre><code>tensor([[1.6522e-02, 6.2036e-01, 1.0433e-01, 2.5879e-01],
        [9.9965e-01, 6.5788e-05, 1.8450e-05, 2.6785e-04],
        [7.6673e-05, 1.9704e-01, 8.0201e-01, 8.7218e-04],
        ...,
        [7.4634e-05, 1.9501e-01, 8.0407e-01, 8.4751e-04],
        [9.4785e-01, 7.4712e-03, 6.1182e-04, 4.4064e-02],
        [3.6306e-02, 1.2466e-01, 2.8862e-03, 8.3615e-01]],
       grad_fn=&lt;SoftmaxBackward0&gt;)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="129">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1"></a>plt.matshow(yhat.data[:<span class="dv">15</span>]) <span class="co"># 앞에 15개</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="129">
<pre><code>&lt;matplotlib.image.AxesImage at 0x7f240219a760&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="2023-02-28-rnn3_files/figure-html/cell-52-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="135">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1"></a><span class="co"># x[:8]</span></span>
<span id="cb78-2"><a href="#cb78-2"></a>y[:<span class="dv">8</span>], y[<span class="op">-</span><span class="dv">15</span>:]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="135">
<pre><code>(tensor([[0., 1., 0., 0.],
         [1., 0., 0., 0.],
         [0., 0., 1., 0.],
         [1., 0., 0., 0.],
         [0., 0., 0., 1.],
         [1., 0., 0., 0.],
         [0., 1., 0., 0.],
         [1., 0., 0., 0.]]),
 tensor([[0., 0., 1., 0.],
         [1., 0., 0., 0.],
         [0., 0., 0., 1.],
         [1., 0., 0., 0.],
         [0., 1., 0., 0.],
         [1., 0., 0., 0.],
         [0., 0., 1., 0.],
         [1., 0., 0., 0.],
         [0., 0., 0., 1.],
         [1., 0., 0., 0.],
         [0., 1., 0., 0.],
         [1., 0., 0., 0.],
         [0., 0., 1., 0.],
         [1., 0., 0., 0.],
         [0., 0., 0., 1.]]))</code></pre>
</div>
</div>
<div class="cell" data-execution_count="133">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb80-1"><a href="#cb80-1"></a>plt.matshow(yhat.data[<span class="op">-</span><span class="dv">15</span>:])  <span class="co"># 끝에 15개</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="133">
<pre><code>&lt;matplotlib.image.AxesImage at 0x7f2401f57490&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="2023-02-28-rnn3_files/figure-html/cell-54-output-2.png" class="img-fluid"></p>
</div>
</div>
<ul>
<li>아주 특이한 특징: yhat[:15], yhat[-15:]의 적합결과가 다르다.</li>
<li>왜? 간장계란밥은 간장이 중요한데, 간장은 시간이 갈수록 맛있어지니까..!
<ul>
<li>뒤에있는 적합결과가 앞에있는 적합결과보다 더 잘맞는다.<span class="math inline">\(\to\)</span> 뒤에있는 애가 앞에있는 정보를 더 많이 활용하기 때문이다.</li>
</ul></li>
</ul>
<p>첫번째 순환신경망 성공적으로 학습!!!</p>
</section>
<section id="순환신경망-구현2-with-rnncell-hidden-node-2---성공" class="level2">
<h2 class="anchored" data-anchor-id="순환신경망-구현2-with-rnncell-hidden-node-2---성공">순환신경망 구현2 (with RNNCell, hidden node 2) - 성공</h2>
<ul>
<li>ref: https://pytorch.org/docs/stable/generated/torch.nn.RNNCell.ht</li>
</ul>
<p><code>(1)</code> 숙성네트워크</p>
<p>선언</p>
<div class="cell" data-execution_count="136">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb82-1"><a href="#cb82-1"></a>rnncell <span class="op">=</span> torch.nn.RNNCell(<span class="dv">4</span>,<span class="dv">2</span>) <span class="co"># x: (n,4) h:(n,2) // 콩물의 dim , 간장(hidden layer)의 dim</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>가중치초기화 (순환신경망 구현1과 동일하도록)</p>
<div class="cell" data-execution_count="137">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb83-1"><a href="#cb83-1"></a><span class="co"># 비교를 위한것.</span></span>
<span id="cb83-2"><a href="#cb83-2"></a>torch.manual_seed(<span class="dv">43052</span>)</span>
<span id="cb83-3"><a href="#cb83-3"></a>_rnncell <span class="op">=</span> rNNCell()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="139">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb84-1"><a href="#cb84-1"></a>rnncell.weight_ih.data <span class="op">=</span> _rnncell.i2h.weight.data </span>
<span id="cb84-2"><a href="#cb84-2"></a>rnncell.weight_hh.data <span class="op">=</span> _rnncell.h2h.weight.data </span>
<span id="cb84-3"><a href="#cb84-3"></a>rnncell.bias_hh.data <span class="op">=</span> _rnncell.h2h.bias.data </span>
<span id="cb84-4"><a href="#cb84-4"></a>rnncell.bias_ih.data <span class="op">=</span> _rnncell.i2h.bias.data </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>(2)</code> 조리담당 네트워크</p>
<div class="cell" data-execution_count="140">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb85-1"><a href="#cb85-1"></a>torch.manual_seed(<span class="dv">43052</span>)</span>
<span id="cb85-2"><a href="#cb85-2"></a>cook <span class="op">=</span> torch.nn.Linear(<span class="dv">2</span>,<span class="dv">4</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>(3)</code> 손실함수, 옵티마이저 설계</p>
<div class="cell" data-execution_count="141">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb86-1"><a href="#cb86-1"></a>loss_fn <span class="op">=</span> torch.nn.CrossEntropyLoss() </span>
<span id="cb86-2"><a href="#cb86-2"></a>optimizr <span class="op">=</span> torch.optim.Adam(<span class="bu">list</span>(rnncell.parameters())<span class="op">+</span><span class="bu">list</span>(cook.parameters()))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>(4)</code> 학습 (6분정도 걸림)</p>
<div class="cell" data-execution_count="143">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb87-1"><a href="#cb87-1"></a>T <span class="op">=</span> <span class="bu">len</span>(x) </span>
<span id="cb87-2"><a href="#cb87-2"></a><span class="cf">for</span> epoc <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">5000</span>): </span>
<span id="cb87-3"><a href="#cb87-3"></a>    <span class="co">## 1~2</span></span>
<span id="cb87-4"><a href="#cb87-4"></a>    loss <span class="op">=</span> <span class="dv">0</span> </span>
<span id="cb87-5"><a href="#cb87-5"></a>    ht <span class="op">=</span> torch.zeros(<span class="dv">1</span>,<span class="dv">2</span>) </span>
<span id="cb87-6"><a href="#cb87-6"></a>    <span class="cf">for</span> t <span class="kw">in</span> <span class="bu">range</span>(T):</span>
<span id="cb87-7"><a href="#cb87-7"></a>        xt,yt <span class="op">=</span> x[[t]], y[[t]]</span>
<span id="cb87-8"><a href="#cb87-8"></a>        ht <span class="op">=</span> rnncell(xt,ht) </span>
<span id="cb87-9"><a href="#cb87-9"></a>        ot <span class="op">=</span> cook(ht) </span>
<span id="cb87-10"><a href="#cb87-10"></a>        loss <span class="op">=</span> loss <span class="op">+</span> loss_fn(ot,yt) </span>
<span id="cb87-11"><a href="#cb87-11"></a>    <span class="co">## 3 </span></span>
<span id="cb87-12"><a href="#cb87-12"></a>    loss.backward()</span>
<span id="cb87-13"><a href="#cb87-13"></a>    <span class="co">## 4 </span></span>
<span id="cb87-14"><a href="#cb87-14"></a>    optimizr.step()</span>
<span id="cb87-15"><a href="#cb87-15"></a>    optimizr.zero_grad()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>(5)</code> 시각화</p>
<div class="cell" data-execution_count="144">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb88-1"><a href="#cb88-1"></a>T <span class="op">=</span> <span class="bu">len</span>(x) </span>
<span id="cb88-2"><a href="#cb88-2"></a>hidden <span class="op">=</span> torch.zeros(T,<span class="dv">2</span>) <span class="co"># 599년치 h를 담을 변수 </span></span>
<span id="cb88-3"><a href="#cb88-3"></a>_water <span class="op">=</span> torch.zeros(<span class="dv">1</span>,<span class="dv">2</span>) <span class="co"># 맹물 </span></span>
<span id="cb88-4"><a href="#cb88-4"></a>hidden[[<span class="dv">0</span>]] <span class="op">=</span> rnncell(x[[<span class="dv">0</span>]],_water) </span>
<span id="cb88-5"><a href="#cb88-5"></a><span class="cf">for</span> t <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>,T):</span>
<span id="cb88-6"><a href="#cb88-6"></a>    hidden[[t]] <span class="op">=</span> rnncell(x[[t]],hidden[[t<span class="op">-</span><span class="dv">1</span>]]) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="145">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb89-1"><a href="#cb89-1"></a>yhat <span class="op">=</span> soft(cook(hidden))</span>
<span id="cb89-2"><a href="#cb89-2"></a>yhat</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="145">
<pre><code>tensor([[1.6522e-02, 6.2036e-01, 1.0433e-01, 2.5879e-01],
        [9.9965e-01, 6.5788e-05, 1.8450e-05, 2.6785e-04],
        [7.6673e-05, 1.9704e-01, 8.0201e-01, 8.7218e-04],
        ...,
        [7.4634e-05, 1.9501e-01, 8.0407e-01, 8.4751e-04],
        [9.4785e-01, 7.4712e-03, 6.1182e-04, 4.4064e-02],
        [3.6306e-02, 1.2466e-01, 2.8862e-03, 8.3615e-01]],
       grad_fn=&lt;SoftmaxBackward0&gt;)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="146">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb91-1"><a href="#cb91-1"></a>plt.matshow(yhat.data[<span class="op">-</span><span class="dv">15</span>:])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="146">
<pre><code>&lt;matplotlib.image.AxesImage at 0x7f2401dd61f0&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="2023-02-28-rnn3_files/figure-html/cell-63-output-2.png" class="img-fluid"></p>
</div>
</div>
</section>
</section>
<section id="숙제" class="level1">
<h1>숙제</h1>
<p>아래와 같은 자료가 있다고 가정하자.</p>
<div class="cell" data-execution_count="212">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb93-1"><a href="#cb93-1"></a>x <span class="op">=</span> torch.rand([<span class="dv">1000</span>,<span class="dv">1</span>])<span class="op">*</span><span class="dv">2</span><span class="op">-</span><span class="dv">1</span></span>
<span id="cb93-2"><a href="#cb93-2"></a>y <span class="op">=</span> <span class="fl">3.14</span> <span class="op">+</span> <span class="fl">6.28</span><span class="op">*</span>x <span class="op">+</span> torch.randn([<span class="dv">1000</span>,<span class="dv">1</span>]) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="213">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb94-1"><a href="#cb94-1"></a>plt.plot(x,y,<span class="st">'o'</span>,alpha<span class="op">=</span><span class="fl">0.1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="2023-02-28-rnn3_files/figure-html/cell-65-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>아래의 모형을 가정하고 <span class="math inline">\(\alpha_0, \alpha_1, \beta_0, \beta_1\)</span>을 파이토치를 이용하여 추정하고자 한다.</p>
<ul>
<li><span class="math inline">\(y_i = \alpha_0 + \beta_0 + \beta_1x_i + \alpha_1x_i + \epsilon_i,\quad \epsilon_i \sim N(0,\sigma^2)\)</span></li>
</ul>
<p>아래는 이를 수행하기 위한 코드이다. ???를 적절히 채워서 코드를 완성하라.</p>
<div class="cell" data-execution_count="214">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb95-1"><a href="#cb95-1"></a>alpha0 <span class="op">=</span> torch.tensor([<span class="fl">0.5</span>], requires_grad<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb95-2"><a href="#cb95-2"></a>alpha1 <span class="op">=</span> torch.tensor([[<span class="fl">0.5</span>]], requires_grad<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb95-3"><a href="#cb95-3"></a>beta0 <span class="op">=</span> torch.tensor([<span class="fl">0.7</span>], requires_grad<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb95-4"><a href="#cb95-4"></a>beta1 <span class="op">=</span> torch.tensor([[<span class="fl">0.7</span>]], requires_grad<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="215">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb96-1"><a href="#cb96-1"></a><span class="co">## 학습 전</span></span>
<span id="cb96-2"><a href="#cb96-2"></a>plt.plot(x,y,<span class="st">'o'</span>)</span>
<span id="cb96-3"><a href="#cb96-3"></a>plt.plot(x,((alpha0<span class="op">+</span>alpha1)<span class="op">*</span>x<span class="op">+</span>(beta0<span class="op">+</span>beta1)).data,<span class="st">'--'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="2023-02-28-rnn3_files/figure-html/cell-67-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="216">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb97-1"><a href="#cb97-1"></a><span class="co"># 수식길게 쓰기 싫으니까 이렇게 바꿔줘야지..</span></span>
<span id="cb97-2"><a href="#cb97-2"></a>b <span class="op">=</span> torch.tensor([alpha0 <span class="op">+</span> beta0], requires_grad<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb97-3"><a href="#cb97-3"></a>w <span class="op">=</span> torch.tensor([alpha1 <span class="op">+</span> beta1], requires_grad<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="217">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb98-1"><a href="#cb98-1"></a>loss_fn <span class="op">=</span> torch.nn.MSELoss()</span>
<span id="cb98-2"><a href="#cb98-2"></a>optimizr <span class="op">=</span> torch.optim.SGD([b, w], lr<span class="op">=</span><span class="dv">1</span><span class="op">/</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="218">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb99-1"><a href="#cb99-1"></a><span class="cf">for</span> epoc <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1000</span>):</span>
<span id="cb99-2"><a href="#cb99-2"></a>    <span class="co">## 1</span></span>
<span id="cb99-3"><a href="#cb99-3"></a>    yhat <span class="op">=</span> b <span class="op">+</span> w<span class="op">*</span>x  <span class="co"># alpha0 + beta0 + alpha1*x + beta1*x </span></span>
<span id="cb99-4"><a href="#cb99-4"></a>    <span class="co">## 2 </span></span>
<span id="cb99-5"><a href="#cb99-5"></a>    loss <span class="op">=</span> loss_fn(yhat,y) </span>
<span id="cb99-6"><a href="#cb99-6"></a>    <span class="co">## 3 </span></span>
<span id="cb99-7"><a href="#cb99-7"></a>    loss.backward()</span>
<span id="cb99-8"><a href="#cb99-8"></a>    <span class="co">## 4 </span></span>
<span id="cb99-9"><a href="#cb99-9"></a>    optimizr.step()</span>
<span id="cb99-10"><a href="#cb99-10"></a>    optimizr.zero_grad()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="219">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb100-1"><a href="#cb100-1"></a><span class="co"># print(alpha0+beta0)</span></span>
<span id="cb100-2"><a href="#cb100-2"></a><span class="bu">print</span>(b)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>tensor([3.1339], requires_grad=True)</code></pre>
</div>
</div>
<ul>
<li>3.14 근처</li>
</ul>
<div class="cell" data-execution_count="220">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb102-1"><a href="#cb102-1"></a><span class="co"># print(alpha1+beta1)</span></span>
<span id="cb102-2"><a href="#cb102-2"></a><span class="bu">print</span>(w)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>tensor([6.2429], requires_grad=True)</code></pre>
</div>
</div>
<ul>
<li>6.28근처</li>
</ul>
<div class="cell" data-execution_count="224">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb104-1"><a href="#cb104-1"></a><span class="co">## 학습 후</span></span>
<span id="cb104-2"><a href="#cb104-2"></a>plt.plot(x,y,<span class="st">'o'</span>)</span>
<span id="cb104-3"><a href="#cb104-3"></a>plt.plot(x, (b<span class="op">+</span>w<span class="op">*</span>x).data,<span class="st">'--'</span>)</span>
<span id="cb104-4"><a href="#cb104-4"></a><span class="co"># plt.plot(x,((alpha0+alpha1)*x+(beta0+beta1)).data,'--')</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="2023-02-28-rnn3_files/figure-html/cell-73-output-1.png" class="img-fluid"></p>
</div>
</div>
<ul>
<li>학습이 잘 된 것 같다.</li>
</ul>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>